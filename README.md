
# Intera Legal Site (Relative Paths)

GitHub Pages の Project site / User site どちらでも動くよう相対パスで構成。


## Announcement配信
この項目トは、アプリ内お知らせ（Announcements）を JSON ファイルで運用するための手引きです。
配信先：announcements.json（GitHub Pages / サーバ上）

仕組みの概要
	•	アプリは定期的（最短15分間隔）に announcements.json を取得し、掲載条件に合うものを抽出します。
	•	ブロッキング告知（required=true） は、フルスクリーンのモーダルで 1 件だけ表示されます（既読後は同じ id では再表示されません）。
	•	非ブロッキング告知（required=false） は内部配列に保持されます。現状 UI では自動表示しません（バナー等の別UIで使用）。

用語
	•	既読：ユーザーがモーダルを閉じると、その id は既読として保存されます（同一 id は再表示されません）。

⸻

まずはこれだけ（最短手順）
	1.	announcements.json を開く
	2.	1件追加する：id は必ず一意の文字列にする（例：2025-09-10-maint-001）
	3.	必ず見せたい告知なら required: true を設定
	4.	掲載期間 startAt / endAt を ISO8601 で設定（例：2025-09-10T00:00:00+09:00）
	5.	公開（サーバにアップ）
	6.	端末でアプリを起動（または再起動）して表示確認
	•	直後は反映されないことがあります（取得は15分間隔）。急ぐ場合はアプリ再起動が確実です

JSONフォーマット例
```
{
  "announcements": [
    {
      "id": "2025-09-10-maint-001",
      "title": "メンテナンスのお知らせ",
      "body": "9/12 01:00〜03:00 にメンテナンスを行います。",
      "actionLabel": "詳細を見る",
      "actionUrl": "https://example.com/news/2025-09-10",
      "priority": "normal",
      "required": true,
      "startAt": "2025-09-10T00:00:00+09:00",
      "endAt":   "2025-09-13T00:00:00+09:00",
      "targets": {
        "minAppVersion": "1.0.0",
        "maxAppVersion": null,
        "locales": ["ja"],
        "themes":  ["Simple","Dive"]
      }
    }
  ]
}
```
各項目の説明

ルート
	•	announcements（配列）
告知オブジェクトのリスト。配列の順番が重要です。ブロッキング告知は条件一致した先頭の 1 件のみ表示されます。

告知オブジェクト
	•	id（必須・文字列）
告知を一意に識別する ID。既読管理にも使用。
	•	同じ id の告知は一度閉じると再表示されません。再表示したい場合は 新しい id にしてください。
	•	title（必須・文字列）
短めのタイトル。
	•	body（任意・文字列）
詳細文。複数行可。
	•	actionLabel / actionUrl（任意）
ボタン文言とリンク先。actionUrl は https 推奨（iOS のセキュリティ制約/ATS）。
	•	http を使う場合はアプリ側に特別な許可設定が必要です。
	•	priority（任意・文字列）
"normal" / "high" を想定。現状のアプリでは未使用（将来の並び替え・強調用）。
	•	required（任意・真偽。既定：false）
	•	true：ブロッキング（フルスクリーンで必ず見せる）。1件のみ表示。既読後は同じ id で再表示されません。
	•	false：非ブロッキング（現状 UI では自動表示なし。別UIが必要）。
	•	startAt / endAt（任意・ISO8601 日時）
掲載期間。タイムゾーンを必ず含める（例：Z または +09:00）。
	•	期間外（開始前・終了後）は表示対象外です。
	•	targets（任意・オブジェクト）
配信対象を絞り込みます。指定がなければ全体が対象。
	•	minAppVersion / maxAppVersion（SemVer "1.2.3"）
	•	minAppVersion 未満のアプリには出ない
	•	maxAppVersion を超えるアプリには出ない
	•	未指定なら null
	•	locales（言語コードの配列。例：["ja","en"]）
	•	言語コードで判定します（ja など）。大文字小文字は不問。
	•	themes（テーマ名の配列。例：["Simple","Dive"]）
	•	アプリ側で小文字化して比較します。表記ゆれは気にしなくてOK。

⸻

運用のコツ・ルール
	•	ID 設計：YYYY-MM-DD-用途-連番 など、見てわかる・重複しないルールで。
例：2025-10-01-release-001、2025-10-01-maint-002。
	•	再表示したい：id を新しくする（既読は id 単位）。
	•	すぐ反映されない：取得は 15分間隔。テスト時はアプリを再起動。
	•	複数ブロッキング：条件一致が複数あると 配列の先頭 1 件のみ表示。並び順に注意。
	•	期間の時差：startAt/endAt は タイムゾーン必須。Z（UTC）か +09:00 などを明記。
	•	リンクの安全：actionUrl は https を使う（http は基本不可）。
	•	非ブロッキングの見せ方：現状は自動表示されません。必要なら別のバナー/リスト UI で announcements を活用してください。

⸻

よくある質問（FAQ）

Q. 公開したのに出ません。
A. 次を確認してください：
	•	15分以内の再取得制限に当たっていませんか？（再起動で即時確認）
	•	required は true ですか？（非ブロッキングは現状 UI では出ません）
	•	startAt / endAt の期間内ですか？タイムゾーンは入っていますか？
	•	targets の条件に合致していますか？（バージョン・言語・テーマ）
	•	以前に同じ id を既読にしていませんか？（id を変える）

Q. すぐに停止したい。
A. endAt を現在より前にして再公開してください。端末側の再取得（〜15分）またはアプリ再起動が必要です。

Q. 同時に複数の重要告知を出したい。
A. ブロッキングは 1 件のみ。配列の先頭に最優先を置き、残りは順次 id を変えて出すか、期間をずらします。

 
